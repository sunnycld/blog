title: c++ 与 java 交互的通道———— jni
date: 2016-02-03 22:32:33
modified: 2016-02-03 22:32:33
author: jxyi
postid: $POSTID
slug: $SLUG
nicename: jni
attachments: $ATTACHMENTS
posttype: post
poststatus: draft
tags: java c++ jni lua
category: program

## 背景介绍

最近在做关于代码跨平台的工作，目的是在 c++ 层写通用的界面，在 java 和 iOS 层使用系统支持的 webView 展示网页内容。这两天在做 c++ 与 java 的互调，遂写下这篇博文记录自己的心得，同时方便自己以后查阅。

<!--more-->

其实我第一次接触 jni 已经是很久之前的事了，不过那个时候的我还只是一个“萌新”，能够改改已有的代码，实现 c++ 到 java 的单向调用就已经很开心了。而现在，我已经工作两年了，不敢说有多深的领悟，但至少有些自己的体会。

## jni 是什么

现在流行的编程语言可谓百家争鸣，c++ 和 java 毋庸置疑是主流中的主流了。java 以其跨平台能力闻名，而 c++ 则是老牌的高性能语言。当我们要结合这两者的时候，就不可避免地要面对 c++ 和 java 互相沟通的问题。jni 就是为了解决这个问题而诞生的。换句话说，jni 就是本地语言和 java 之间的桥梁，具体的定义可以自行查找。下面主要介绍 c++ 与 java 的互调。

## 基本原理

在介绍如何使用之前，我觉得有必要讲解一下 jni 的基本原理。

计算机程序最终都是二进制的程序，而二进制程序的运行过程就是指导计算机把数据存到哪个寄存器，到内存的哪个位置去取数据，如何计算传入的两个数据等等这些事情。（请参看[冯·诺依曼体系结构](http://baike.baidu.com/view/9427882.htm)）而高级语言就是将人类方便理解的代码翻译成二进制程序。从这个角度看，c++ 和 java 是一样的，它们都是去指导计算机怎么运行，然后得到预期的结果。了解了这一点之后，我们就可以发现它们的共同点————指导计算机运行。既然如此，我们只要知道如何启动这些二进制程序就可以了。所以，c++ 和 java 如果互相知道如何启动对方的程序，不就实现了 c++ 与 java 的互调了吗？

## java 调用 c++

从上面的基本原理中，我们知道只要告诉 java 如何去调用 c++ 编写的程序就可以了。因为 java 是运行在 [java 虚拟机](http://baike.baidu.com/view/374952.htm)上的，所以我们只需要将 c++ 中的方法注册到 java 虚拟机中，java 就能够调用 c++ 的方法了。首先，我们需要将 c++ 代码编译成 java 能够认识的中间文件 ———— so 或者 dll 文件。如果你在 windows 环境中，可以使用 dll 文件，而在 Unix 环境中请使用 so 文件。这里我们假设生成的中间文件为 native.so 。



