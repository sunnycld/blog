title: iOS 开发相关证书介绍
date: 2016-03-10 22:46:09
modified: 2016-03-10 22:46:09
author: jxyi
postid: 89
slug: 89
nicename: iOS_certificate
attachments: 86,87,88
posttype: post
poststatus: publish
tags: ios
category: tips

## 前言

本文将记录一些我在 iOS 应用打包发布过程中遇到的一些疑问和总结。作为一个习惯了 windows 环境的小白来说，iOS 的各类证书、签名、授权等等都是那么复杂而难以理解。之前虽然打过包，但是当时是在同事的帮助下完成的，而且同事一通眼花缭乱的操作之后，虽然解决了问题，但是我并没有留下什么印象。当需要我再次发布 iOS 包的时候，依然是一头雾水。所以我写下这篇博文，作为自己的备忘录，如果还能帮助到其他人，那自然是极好的。

<!--more-->

## 获取苹果身份证

在开始玩 iOS 之前，我们需要申请一个 Apple ID。在 [这里](https://appleid.apple.com/account) 申请一个 Apple ID。申请 Apple ID 是免费的，而这个 Apple ID 将作为我们使用苹果产品和服务的身份证。

获得 Apple ID 之后，我们就能使用 xcode 进行开发。如果你是接手别人留下来的 mac 电脑，记得一定要找个空闲的时间将原来的 xcode 卸载，然后使用自己的 Apple ID 下载一个 xcode。因为苹果的软件安装和升级时，是需要输入对应 Apple ID 和密码的。如果是用别人的 Apple ID 安装的 xcode，由于你不知道别人的密码，就无法升级。因为 xcode 很大，下载需要很长时间，如果这个时候提交应用需要 xcode 的某个新版本，而你当前的 xcode 版本较低，就会出现无法打包或者提交包到 itunes 的情况。这个时候再去卸载重装，会浪费很多时间，有可能导致进度 delay。

当然，如果之前的 Apple ID 是公用的，你也知道密码，就不用卸载重装了。

## 开发者账号

现在，我们已经可以愉快地使用 xcode 写代码了。不过，现在的我们也只能写代码，并不能打出一个可以安装运行的包，因为我们没有打包的证书和签名。

要能开发 iOS app，我们需要申请成为苹果开发者。打开 [这个网页](https://developer.apple.com/)，点击右上方的 “program”，然后用自己的 Apple ID 登录。如果又弹回了主界面，再次点击 “program” 进入，就能够以登录后的状态访问这个页面了。找到右上角的 “enroll” 按钮，这个就是申请成为苹果开发者的入口。进入后会填写很多信息，大部分都没什么问题，这里讲一下苹果开发者的类型，也就是第一页表单最下面的一个选项。

苹果开发者账号分为个人、团体和企业。个人账号和团体账号价格都是 $99，而企业号的价格是 $299。个人账号就是给个人用的，这个账号不能共享出去，只能使用申请时登录的 Apple ID 进行包的发布。团体账号可以分发多个发布证书，让多个 Apple ID “共享” 团体账号的发布权限，同时可以添加多个 Apple ID 帮助管理团队账号。个人账号和团队账号都是可以将应用发布到 App Store 的。

企业账号用于大型企业内部开发自己使用的 App，**企业账号不能发布应用到 App Store**。而且企业号很难申请，这里我就不多讲了，因为我也不了解企业账号。

## 签名证书

一般情况是我们作为员工，使用公司的团体开发者账号开发和发布应用。所以第一步就是申请将自己的 Apple ID 加入到公司的团体开发者账号中。

使用公司开发者账号登录 [苹果开发者网站](https://developer.apple.com/)，在 “perple” 选项卡中点击 “invite” 按钮，邀请自己的 Apple ID 成为团队中的一员。邀请之后苹果网站会向 Apple ID 对应的邮箱发送邮件，在邮件中激活后，就加入到团队账号中了。

之后进入主页，选择 “Certificates, Identifiers & Profiles”，可以看到如下页面：

![img](http://jxyi.org/wp-content/uploads/2016/03/certificate1.png)

点击 Certificate 下的 ALL 选项就能在右侧看到证书列表了。在右上方有一个加号的按钮，点击这个按钮就能创建证书了。

## 创建证书和发布配置

要想在真机上调试，我们必须要有开发者证书。团队账号可以创建几个开发者账号，一般是 5 个。点击 Certificate 页面右上方的加号，就可以开始创建开发者证书了，如下图。

![img](http://jxyi.org/wp-content/uploads/2016/03/certificate2.png)

这里选择 “iOS App Development” ，然后进入下一步，可以见到如下的提示：

![img](http://jxyi.org/wp-content/uploads/2016/03/certificate3.png)

这里是什么意思呢？这里是在告诉我们怎么创建 CSR 文件。那么 CSR 文件是什么？CSR 文件就是证书签名请求文件，只有我们上传了 CSR 文件，才能创建证书。而创建出来的证书将只能在生成 CSR 文件的 MAC 上安装，其他机器无法安装生成的证书。生成 CSR 文件的方法是，打开 MAC 钥匙串管理程序，在菜单中找到证书助手，点击 “从证书机构请求” 选项。然后在对话框中填入自己的邮箱和生成后的 CSR 文件的文件名，再选中保存到本地，点击确定就生成 CSR 文件了。然后将 CSR 文件上传到证书申请页面中，就能生成开发者证书了，下载证书并双击安装，就能使用了。

发布证书的创建方法与开发者证书类似，就不重复说明了。需要注意的是，发布证书同样有数量限制，如果创建的发布证书数量达到上限，将无法再创建新的发布证书。这个时候就需要找已经安装了发布证书的人，让他在钥匙串管理中将发布证书导出一份，导出的文件为 .p12 格式。导出时会设置一个密码，我们在双击安装这个 p12 文件时就需要输入该密码。安装了发布证书后，我们就能对包签名了。

不过有发布证书还不够，我们还需要发布配置文件。为什么需要这个呢？因为不是所有的包名都能以这个发布证书发布的，只有被团队账号创建的包名才能用团队的发布证书发布。这样做的目的是保护开发者权益，防止发布证书被盗用。

在上面的图中，可以看到左侧还有三个大的类别——Identifiers、Devices 和 Provisioning Profiles。Identifiers 里面就是用来管理 bundle ID 的，所以需要发布的包名都必须现在这里创建。Devices 下面管理所有能在该团队账号下进行测试的设备，所以需要将测试机都添加到这里。Provisioning Profiles 就是用来管理发布配置的，发布配置将发布证书和 bundle ID 对应起来，意思就是指定的 bundle ID 只能使用对应的发布证书去签名才能发布。当然，发布配置不止发布到 AppStore 一种类型，还有开发类型等等。

创建好发布配置之后，下载安装，现在才真正能够打包并上传包到 AppStore。

在 Xcode 项目设置中，需要设置项目的 bundle ID 和对应的开发者账号。只有按照上述步骤生成了对应的证书和配置，这里填写项目设置时才不会提示错误。

## 后记

iOS 开发的证书很多，虽然繁琐，但是正是这些严格的制度，才保证了开发者的权益不会被侵害。不过更重要的是，你不这么做就上不了 AppStore！


